<!DOCTYPE HTML>
<html>
    
	<head>
		<title>Personal blog around mobile monetization, android and ios development</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="description" content="Personal blog around mobile monetization, Android and iOS development and other things learned while developing mobile apps for both platforms." />
		<meta name="keywords" content="android,monetization" />
		<!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
		<script src="/js/jquery.min.js"></script>
		<script src="/js/jquery.scrollzer.min.js"></script>
		<script src="/js/jquery.scrolly.min.js"></script>
		<script src="/js/skel.min.js"></script>
		<script src="/js/skel-layers.min.js"></script>
		<script src="/js/init.js"></script>
		<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-73073179-1', 'auto');
  ga('send', 'pageview');

</script>
		<noscript>
			<link rel="stylesheet" href="/css/skel.css" />
			<link rel="stylesheet" href="/css/style.css" />
			<link rel="stylesheet" href="/css/style-xlarge.css" />
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" >

		</noscript>
		<!--[if lte IE 8]><link rel="stylesheet" href="css/ie/v8.css" /><![endif]-->
	</head>
		
    <body>
        <div id="wrapper">
        <!-- Header -->
    <section id="header" class="skel-layers-fixed">
        <header>
            <span class="image avatar"><img src="/images/avatar.png" alt="" /></span>
            <h1 id="logo"><a href="/">Andreas Vourkos</a></h1>
              <p>Building mobile apps since the early days of J2ME...</p>
            <span class="image pollfish"><a href="https://www.pollfish.com" target="_blank"> <img  src="/images/polfish.png" alt="" /></a></span>
          <p>The mobile engineer behind <a href="https://www.pollfish.com" target="_blank">Pollfish</a> Android and iOS SDKs</p>

        </header>
        <nav id="nav">
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/android">Android Development</a></li>
                <li><a href="/ios">iOS Development</a></li>
                <li><a href="/monetization">Monetization Tips</a></li>
            </ul>
        </nav>
        <footer>
            <ul class="icons">
                 <li><a href="https://twitter.com/vourkosa" class="icon fa-twitter" target="_blank"><span class="label">Twitter</span></a></li>
                <li><a href="https://www.linkedin.com/in/andreasvourkos" class="icon fa-linkedin" target="_blank"><span class="label">Linkedin</span></a></li>
                <li><a href="https://github.com/vourkosa" class="icon fa-github" target="_blank"><span class="label">Github</span></a></li>
            </ul>
        </footer>
    </section>



            <!-- Main -->
            <div id="main">
                <section>
 
    <div class="container">
    
        <header class="major">
            <h2>How to build an iOS framework with bitcode support, keeping backwards compatibility with XCode 6</h2>
                <p class="post-meta">14 April 2016&nbsp;&nbsp; | &nbsp;&nbsp; iOS    </p>  
        </header>

        <section class="post-content">
            <p>When creating our own iOS framework, after the release of XCode 7 we needed to start supporting bitcode. For those not familiar with bitcode, bitcode is an intermediate representation of a compiled program and is part of the App Thinning feature introduced in XCode 7. With Bitcode, apps can be re-optimized for each device before being delivered to a user. You can read more on this on Apple docs <a href="https://developer.apple.com/library/tvos/documentation/IDEs/Conceptual/AppDistributionGuide/AppThinning/AppThinning.html" target="_blank">here.</a></p>

<h3>The problem</h3>

<p>You can easily build an iOS library with bitcode support. In order to achieve that you just need to go to <b>Build settings</b>, search for <b>“custom compiler flags”</b> and add <b>-fembed-bitcode</b>. This flag informs XCode to build the library with bitcode and everything works fine under XCode 7. However by following the approach above we loose backwards compatibility with XCode 6. Having that said we need to ship 2 different library versions, one with bitcode flag and one without, since not everyone in our developers’ community upgraded to XCode 7.</p>

<h3>The solution</h3>

<p>In order to be able to provide a single framework that would support both bitcode enabled or not apps, we needed to create a fat library that would include both configurations.</p>

<p>We build therefore our configurations with xcodebuild both with ENABLE_BITCODE=NO and ENABLE_BITCODE=YES as shown below:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>xcodebuild -configuration "Release" ENABLE_BITCODE=NO -target "${FMK_NAME}" -sdK iphoneos 
xcodebuild -configuration "Release" ENABLE_BITCODE=NO -target "${FMK_NAME}" -sdk iphonesimulator
xcodebuild -configuration "Release" ENABLE_BITCODE=YES -target "${FMK_NAME}" -sdk iphonesimulator
xcodebuild -configuration "Release" ENABLE_BITCODE=YES -target "${FMK_NAME}" -sdk iphoneos
</code></pre>
</div>

<p>and then create a fat library using <b>lipo</b> command like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>lipo -create "${DEVICE_DIR}/${FMK_NAME}" "${SIMULATOR_DIR}/${FMK_NAME}" -output "${INSTALL_DIR}/Versions/${FMK_VERSION}/${FMK_NAME}"
</code></pre>
</div>

<p>You can easily check if a binary is bitcode compatible with <b>otool</b>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>otool -l (myLibName.o or myLibName.a file) | grep __LLVM.
</code></pre>
</div>

<p>The generated framework supports both bitcode-enabled and non bitcode-enabled apps, both on XCode 6 and XCode 7.</p>

<h3>P.S. Tip</h3>

<p>Since XCode 7.3, there is a major bug when running xcodebuild from a “Run Script”, that affects the environment variable TOOLCHAINS. This is a known bug and the only workaround at the moment as described <a href="http://stackoverflow.com/questions/36184930/xcodebuild-7-3-cant-enable-bitcode" target="_blank"> here </a> is to unset TOOLCHAINS at the beginning of your script:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>unset TOOLCHAINS
</code></pre>
</div>

        
        </section>
       
 
 <div class="share-page">
    <a href="https://twitter.com/intent/tweet?text=How to build an iOS framework with bitcode support, keeping backwards compatibility with XCode 6&url=http://vourkosa.github.io/ios/2016/04/14/How-to-build-an-iOS-library-with-Bitcode-support-and-keep-backwards-compatibility-with-XCode-6.html&via=vourkosa&related=vourkosa" rel="nofollow" target="_blank" title="Share on Twitter"><i class="fa fa-twitter"></i></a>
    &nbsp;&nbsp;<a href="https://facebook.com/sharer.php?u=http://vourkosa.github.io/ios/2016/04/14/How-to-build-an-iOS-library-with-Bitcode-support-and-keep-backwards-compatibility-with-XCode-6.html" rel="nofollow" target="_blank" title="Share on Facebook"><i class="fa fa-facebook"></i></a>
    &nbsp;&nbsp;<a href=" http://www.linkedin.com/shareArticle?mini=true&url=http://vourkosa.github.io/ios/2016/04/14/How-to-build-an-iOS-library-with-Bitcode-support-and-keep-backwards-compatibility-with-XCode-6.html&title=How to build an iOS framework with bitcode support, keeping backwards compatibility with XCode 6&source=" rel="nofollow" target="_blank"><i class="fa fa-linkedin"></i></a>
    &nbsp;&nbsp;<a href="https://plus.google.com/share?url=http://vourkosa.github.io/ios/2016/04/14/How-to-build-an-iOS-library-with-Bitcode-support-and-keep-backwards-compatibility-with-XCode-6.html" rel="nofollow" target="_blank" title="Share on Google+"><i class="fa fa-google-plus"></i></a>
    &nbsp;&nbsp;<a href="http://www.reddit.com/submit?url=http://vourkosa.github.io/ios/2016/04/14/How-to-build-an-iOS-library-with-Bitcode-support-and-keep-backwards-compatibility-with-XCode-6.html" rel="nofollow" target="_blank" title="Share on Reddit"><i class="fa fa-reddit"></i></a>



</div>
</br>
</br>

<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vourkosa'; // required: replace example with your forum shortname
    	var disqus_developer = 1; // Comment out when the site is live
        var disqus_identifier = "/ios/2016/04/14/How-to-build-an-iOS-library-with-Bitcode-support-and-keep-backwards-compatibility-with-XCode-6.html";
//s.src = '//vourkosa.disqus.com/embed.js';

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


        <footer>
        <div class="foot">
            
            <a href="/android/2016/04/06/Sharing-code-among-Android-applications-Including-and-reading-images-from-jar-files.html" class="button special2">Previous</a> 
            
        </footer>
  </div>
    </div>

</section>


            </div>
            <!-- Footer -->
    <section id="footer">
        <div class="container">
            <ul class="copyright">
                <li>&copy; Andreas Vourkos 2016. All rights reserved.</li>
                <li>A Jekyll Theme by: <a href="http://html5up.net">HTML5 UP</a></li>
            </ul>
        </div>
    </section>

		</div>
	</body>
</html>